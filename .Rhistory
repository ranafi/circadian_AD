load("/Users/henryhollis/Box Sync/Henry_stuff/AD_project/scROSMAP/scrosmap_newAtlas/scROSMAP_project/BestSubclusters_server_Exc.rda")
View(grid_results)
grid_results[["values"]]
grid_results[["values"]] %>% length
library(tidyverse)
grid_results[["values"]] %>% length
summary(grid_results$values)
library(grr)
library(tidyverse)
library(scales)
# pathways_of_interest = c("Down_SD_3OR6","midbrain_DEG_BHQ1")
pathways_of_interest = c("All_DE_sleep_wake_genes","midbrain_DEG_BHQ1")
Exc_neurons_sleep_pathway = read_csv("../Cyclops_ordering/downstream_output_Exc_All/fGSEA/fGSEA_results_sleep_wake/DRgenesAmpRatio20_Log(AD-CTL)ranked.csv", show_col_types = F) %>% filter(pathway %in% pathways_of_interest)
Inh_neurons_sleep_pathway = read_csv("../Cyclops_ordering/downstream_output_Inhib_All/fGSEA/fGSEA_results_sleep_wake/DRgenesAmpRatio20_Log(AD-CTL)ranked.csv", show_col_types = F) %>% filter(pathway %in% pathways_of_interest)
Ast_neurons_sleep_pathway = read_csv("../Cyclops_ordering/downstream_output_Ast_All/fGSEA/fGSEA_results_sleep_wake/DRgenesAmpRatio20_Log(AD-CTL)ranked.csv", show_col_types = F) %>% filter(pathway %in% pathways_of_interest)
Mglia_neurons_sleep_pathway = read_csv("../Cyclops_ordering/downstream_output_Mglia_All/fGSEA/fGSEA_results_sleep_wake/DRgenesAmpRatio20_Log(AD-CTL)ranked.csv", show_col_types = F) %>% filter(pathway %in% pathways_of_interest)
df = rbind(Exc_neurons_sleep_pathway, Inh_neurons_sleep_pathway, Ast_neurons_sleep_pathway, Mglia_neurons_sleep_pathway)
cell_types = rep(c("Excitatory", "Inhibitory", "Astrocytes", "Microglia"), each = 2)
df$cell_type = cell_types
df = unite(df, label, cell_type, pathway, remove = F)
df$label = df$label %>% str_replace_all("All_DE_sleep_wake_genes", "Sleep DE Genes") %>% str_replace_all("midbrain_DEG_BHQ1", "ARNTL KO DE Genes")  %>% str_replace_all("_", " ")
df_sleep = filter(df, grepl("Sleep", label))
df_KO = filter(df, grepl("KO", label))
#Desired order:
# Reorder the y-axis by setting factor levels
desired_order= c("Excitatory","Inhibitory","Astrocytes", "Microglia")
df_sleep$cell_type <- factor(df_sleep$cell_type, levels = rev(desired_order))
df_KO$cell_type <- factor(df_KO$cell_type, levels = rev(desired_order))
# df$category_wrapped <- str_wrap(df$label, width = 20)
# Shared scale parameters
size_limits <- c(20, 1200)  # Set the range of size values
size_range <- c(5, 10)  # Set the range of dot sizes in the plot
# Create a sleep dot plot
p1 = ggplot(df_sleep, aes(x = NES, y = cell_type, color = -log10(padj), size = size)) +
geom_segment(aes(x = 0, xend = NES, y = cell_type, yend = cell_type),
linetype = "dotted", color = "gray", linewidth = 1) + # Add dotted lines
geom_point() +  # Adjust the size of the dots if needed
scale_size_continuous(range = c(5, 10), limits = size_limits) +  # Adjust the range of point sizes (min, max)
scale_color_gradient(low = "#4575b4", high = "#d73027", limits = c(0, 10),  # Set the visible range
oob = squish ) +  # Customize the color gradient
scale_x_reverse()+
xlim(0,-3)+
labs(x = "NES", y = "Cell Type", color = "-Log10(BH.q)", title = "Genes Affected by Sleep") +  # Label axes and legend
theme_minimal() + # Use a clean theme
theme(
axis.text.x = element_text(size = 14, angle = 0),    # Increase x-axis text size
axis.text.y = element_text(size = 12, angle = 45),    # Increase y-axis text size
axis.title.x = element_text(size = 14),   # Increase x-axis title size
axis.title.y = element_text(size = 14),   # Increase y-axis title size
legend.title = element_text(size = 12)    # Increase legend title size
)
# Create a KO dot plot
p2 = ggplot(df_KO, aes(x = NES, y = cell_type, color = -log10(padj), size = size)) +
geom_segment(aes(x = 0, xend = NES, y = cell_type, yend = cell_type),
linetype = "dotted", color = "gray", linewidth = 1) + # Add dotted lines
geom_point() +  # Adjust the size of the dots if needed
scale_size_continuous(range = c(5, 10),  limits = size_limits) +  # Adjust the range of point sizes (min, max)
scale_color_gradient(low = "#4575b4", high = "#d73027", limits = c(0, 10),  # Set the visible range
oob = squish ) +  # Customize the color gradient
scale_x_reverse()+
xlim(0,-3.0)+
labs(x = "NES", y = "Cell Type",
color = "-Log10(BH.q)", title = "Genes Affected by ARNTL KO") +#Label axes and legend
theme_minimal() + # Use a clean theme
theme(
axis.text.x = element_text(size = 14, angle = 0),    # Increase x-axis text size
axis.text.y = element_text(size = 12, angle = 45),    # Increase y-axis text size
axis.title.x = element_text(size = 14),   # Increase x-axis title size
axis.title.y = element_text(size = 14),   # Increase y-axis title size
legend.title = element_text(size = 12)    # Increase legend title size
)
ggsave("~/Desktop/Sleep_pathway.pdf", plot = p1, width = 5, height = 4, units = "in")
ggsave("~/Desktop/ARNTL_KO_pathway.pdf", plot = p2, width = 5, height = 4, units = "in")
